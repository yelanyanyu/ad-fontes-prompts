<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YAML to Etymology Card Generator</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- JS-YAML -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js"></script>
    <!-- Marked.js for Markdown Rendering -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700&family=Noto+Sans+SC:wght@300;400;500;700&family=Lora:ital,wght@0,400;0,600;0,700;1,400&display=swap" rel="stylesheet">

    <style>
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e0; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #a0aec0; }
        
        .editor-font { font-family: 'Fira Code', 'Consolas', monospace; font-size: 14px; line-height: 1.5; }

        /* Markdown Preview Styles (Simple Github-like) */
        .markdown-body {
            font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif;
            font-size: 16px;
            line-height: 1.6;
            color: #24292e;
        }
        .markdown-body h3 { border-bottom: 1px solid #eaecef; padding-bottom: .3em; font-size: 1.25em; margin-top: 24px; margin-bottom: 16px; font-weight: 600; }
        .markdown-body ul, .markdown-body ol { padding-left: 2em; margin-bottom: 16px; }
        .markdown-body li { margin-top: 0.25em; }
        .markdown-body strong { font-weight: 600; }
        .markdown-body em { font-style: italic; }
        .markdown-body hr { height: 0.25em; padding: 0; margin: 24px 0; background-color: #e1e4e8; border: 0; }
        .markdown-body p { margin-bottom: 16px; }
    </style>
</head>
<body class="bg-gray-100 h-screen flex flex-col text-slate-800 font-sans">

    <!-- Header -->
    <header class="bg-slate-900 text-white p-4 shadow-md flex justify-between items-center shrink-0 z-10">
        <div class="flex items-center gap-3">
            <i class="fa-solid fa-book-journal-whills text-2xl text-amber-400"></i>
            <div>
                <h1 class="text-xl font-bold font-serif tracking-wide">Etymos <span class="text-amber-400">CardGen</span></h1>
                <p class="text-xs text-slate-400">YAML to Semantic HTML Converter</p>
            </div>
        </div>
        <div class="flex gap-3 items-center">
             <div class="relative group">
                <i class="fa-solid fa-palette absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 text-xs pointer-events-none"></i>
                <select id="styleSelect" class="bg-slate-800 text-white text-sm border border-slate-600 rounded pl-8 pr-3 py-1.5 focus:outline-none focus:border-amber-500 transition cursor-pointer appearance-none min-w-[180px]">
                    <option value="card">Card Style (精美卡片)</option>
                    <option value="markdown">Markdown Style (笔记)</option>
                </select>
                <i class="fa-solid fa-chevron-down absolute right-3 top-1/2 transform -translate-y-1/2 text-slate-400 text-xs pointer-events-none"></i>
             </div>

             <button id="loadBtn" class="text-sm bg-slate-700 hover:bg-slate-600 px-3 py-1.5 rounded transition whitespace-nowrap">
                <i class="fa-solid fa-rotate-right mr-1"></i> 示例
            </button>
        </div>
    </header>

    <!-- Main Content -->
    <div class="flex-1 flex flex-col md:flex-row overflow-hidden">
        
        <!-- Input Section -->
        <div class="w-full md:w-1/3 flex flex-col border-r border-gray-300 bg-white">
            <div class="p-2 bg-gray-50 border-b border-gray-200 text-xs font-bold text-gray-500 uppercase tracking-wider flex justify-between">
                <span>YAML Input</span>
                <span id="status" class="text-green-600 hidden"><i class="fa-solid fa-check"></i> Valid</span>
            </div>
            <textarea id="yamlInput" class="flex-1 w-full p-4 resize-none focus:outline-none focus:ring-2 focus:ring-amber-500/50 editor-font text-gray-700" placeholder="Paste your YAML here..." spellcheck="false"></textarea>
        </div>

        <!-- Preview Section -->
        <div class="w-full md:w-2/3 bg-gray-200 overflow-y-auto relative flex flex-col">
            <!-- This container grows with content via min-h-min -->
            <div class="flex-1 p-4 md:p-8 flex justify-center items-start min-h-min">
                
                <div id="previewWrapper" class="w-full transition-all duration-300 flex flex-col gap-6">
                    <!-- Content injected here by JS -->
                </div>

            </div>
        </div>
    </div>

    <script>
        /**
         * App Architecture: Module Pattern
         */
        const App = {
            // State
            elements: {
                yamlInput: document.getElementById('yamlInput'),
                previewWrapper: document.getElementById('previewWrapper'),
                statusSpan: document.getElementById('status'),
                styleSelect: document.getElementById('styleSelect'),
                loadBtn: document.getElementById('loadBtn'),
            },
            data: null,
            currentStyle: 'card',

            // --- Initialization ---
            init() {
                this.bindEvents();
                this.loadExample();
            },

            bindEvents() {
                this.elements.yamlInput.addEventListener('input', () => this.handleInput());
                this.elements.styleSelect.addEventListener('change', (e) => {
                    this.currentStyle = e.target.value;
                    this.render();
                });
                this.elements.loadBtn.addEventListener('click', () => this.loadExample());
            },

            // --- Logic Layer ---
            handleInput() {
                const val = this.elements.yamlInput.value;
                try {
                    this.data = jsyaml.load(val);
                    if (!this.data || !this.data.yield) throw new Error("Missing 'yield' key");
                    
                    this.updateStatus('valid');
                    this.render();
                } catch (e) {
                    this.updateStatus('error');
                    console.warn(e);
                }
            },

            updateStatus(type) {
                const el = this.elements.statusSpan;
                el.classList.remove('hidden');
                if (type === 'valid') {
                    el.innerHTML = '<i class="fa-solid fa-check"></i> Valid YAML';
                    el.className = 'text-green-600 text-xs font-bold uppercase tracking-wider';
                } else {
                    el.innerHTML = '<i class="fa-solid fa-triangle-exclamation"></i> Error';
                    el.className = 'text-red-500 text-xs font-bold uppercase tracking-wider';
                }
            },

            loadExample() {
                this.elements.yamlInput.value = this.getExampleYaml();
                this.handleInput();
            },

            // --- Render Layer ---
            render() {
                if (!this.data) return;

                const wrapper = this.elements.previewWrapper;
                wrapper.innerHTML = ''; // Clear previous

                if (this.currentStyle === 'card') {
                    // 1. Card Mode
                    wrapper.className = "w-full max-w-2xl mx-auto";
                    const html = this.generateCardHTML(this.data);
                    
                    // Container
                    const container = document.createElement('div');
                    container.innerHTML = html;
                    
                    // Action Bar
                    const actionBar = this.createActionBar({
                        onCopy: () => this.copyToClipboard(html, 'code'),
                        label: 'Copy HTML Code (Anki HTML Mode)'
                    });

                    wrapper.appendChild(container);
                    wrapper.appendChild(actionBar);

                } else {
                    // 2. Markdown Mode (Dual View)
                    wrapper.className = "w-full max-w-4xl mx-auto flex flex-col gap-8";
                    
                    const mdSource = this.generateMarkdown(this.data);
                    const renderedHtml = marked.parse(mdSource);

                    // A. Rendered View (Visual)
                    const visualSection = document.createElement('div');
                    visualSection.className = "bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden";
                    visualSection.innerHTML = `
                        <div class="bg-gray-50 border-b border-gray-200 px-4 py-2 flex justify-between items-center">
                            <h3 class="font-bold text-sm text-gray-700 uppercase tracking-wide"><i class="fa-solid fa-eye mr-2"></i>Preview (Rendered)</h3>
                            <button class="text-xs bg-white hover:bg-blue-50 text-blue-600 border border-blue-200 px-3 py-1 rounded shadow-sm transition font-medium" onclick="App.copyRenderedMarkdown()">
                                <i class="fa-regular fa-copy mr-1"></i> Copy Rich Text
                            </button>
                        </div>
                        <div class="p-8 markdown-body" id="md-render-target">
                            ${renderedHtml}
                        </div>
                    `;

                    // B. Source View (Code)
                    const sourceSection = document.createElement('div');
                    sourceSection.className = "bg-slate-800 rounded-lg shadow-sm border border-slate-700 overflow-hidden text-slate-300";
                    sourceSection.innerHTML = `
                         <div class="bg-slate-900 border-b border-slate-700 px-4 py-2 flex justify-between items-center">
                            <h3 class="font-bold text-sm text-slate-400 uppercase tracking-wide"><i class="fa-solid fa-code mr-2"></i>Source (Markdown)</h3>
                            <button class="text-xs bg-slate-700 hover:bg-slate-600 text-white border border-slate-600 px-3 py-1 rounded shadow-sm transition font-medium" onclick="App.copyToClipboard(App.generateMarkdown(App.data), 'text')">
                                <i class="fa-regular fa-copy mr-1"></i> Copy Source
                            </button>
                        </div>
                        <div class="p-4 overflow-x-auto">
                            <pre class="editor-font text-sm whitespace-pre-wrap break-words">${this.escapeHtml(mdSource)}</pre>
                        </div>
                    `;

                    wrapper.appendChild(visualSection);
                    wrapper.appendChild(sourceSection);
                }
            },

            createActionBar({ onCopy, label }) {
                const bar = document.createElement('div');
                bar.className = "flex justify-end mt-2";
                
                const btn = document.createElement('button');
                btn.className = "bg-amber-600 hover:bg-amber-500 text-white px-6 py-2 rounded-full font-bold shadow-lg transition transform active:scale-95 flex items-center gap-2";
                btn.innerHTML = `<i class="fa-solid fa-copy"></i> <span>${label}</span>`;
                btn.onclick = async () => {
                    await onCopy();
                    const icon = btn.querySelector('i');
                    const span = btn.querySelector('span');
                    const originalIcon = icon.className;
                    const originalText = span.innerText;
                    
                    icon.className = "fa-solid fa-check";
                    span.innerText = "Copied!";
                    btn.classList.remove('bg-amber-600', 'hover:bg-amber-500');
                    btn.classList.add('bg-green-600', 'hover:bg-green-500');

                    setTimeout(() => {
                        icon.className = originalIcon;
                        span.innerText = originalText;
                        btn.className = "bg-amber-600 hover:bg-amber-500 text-white px-6 py-2 rounded-full font-bold shadow-lg transition transform active:scale-95 flex items-center gap-2";
                    }, 2000);
                };
                
                bar.appendChild(btn);
                return bar;
            },

            // --- Clipboard Logic ---
            async copyToClipboard(content, mode = 'text') {
                try {
                    await navigator.clipboard.writeText(content);
                } catch (err) {
                    console.error('Copy failed', err);
                    alert("Copy failed");
                }
            },

            copyRenderedMarkdown() {
                const node = document.getElementById('md-render-target');
                if (!node) return;

                const range = document.createRange();
                range.selectNode(node);
                const selection = window.getSelection();
                selection.removeAllRanges();
                selection.addRange(range);

                try {
                    document.execCommand('copy');
                    this.showToast("Rich Text Copied!");
                } catch (err) {
                    console.error('Rich copy failed', err);
                    alert("Rich copy failed");
                }
                selection.removeAllRanges();
            },

            showToast(msg) {
                const toast = document.createElement('div');
                toast.className = "fixed bottom-10 right-10 bg-gray-800 text-white px-4 py-2 rounded shadow-lg text-sm font-bold animate-bounce z-50";
                toast.innerText = msg;
                document.body.appendChild(toast);
                setTimeout(() => toast.remove(), 2000);
            },

            // --- Generators (Logic) ---

            generateCardHTML(data) {
                const c = { bg: "#fcfbf9", textMain: "#2d3748", textSub: "#718096", accent: "#b7791f", accentLight: "#faf5ff", border: "#e2e8f0", sectionHeader: "#2c5282" };
                const s = {
                    card: `font-family: 'Noto Sans SC', sans-serif; max-width: 650px; margin: 0 auto; background-color: ${c.bg}; color: ${c.textMain}; border: 1px solid ${c.border}; border-radius: 8px; overflow: hidden; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);`,
                    section: `padding: 20px; border-bottom: 1px solid ${c.border};`,
                    h1: `font-family: 'Noto Serif SC', serif; font-size: 32px; font-weight: 700; color: ${c.sectionHeader}; margin: 0; line-height: 1.2;`,
                    h2: `font-family: 'Noto Serif SC', serif; font-size: 16px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; color: ${c.accent}; margin-bottom: 12px; border-left: 4px solid ${c.accent}; padding-left: 10px;`,
                    h3: `font-family: 'Noto Serif SC', serif; font-size: 14px; font-weight: 700; color: ${c.sectionHeader}; margin-top: 18px; margin-bottom: 8px; padding-bottom: 4px; border-bottom: 2px solid ${c.border}; display: block;`,
                    sub: `font-size: 14px; color: ${c.textSub}; margin-bottom: 8px;`,
                    p: `font-size: 15px; line-height: 1.6; margin: 0 0 8px 0;`,
                    tag: `display: inline-block; background: ${c.accentLight}; color: ${c.sectionHeader}; padding: 2px 8px; border-radius: 4px; font-size: 12px; font-weight: 600; margin-right: 5px; border: 1px solid #e2e8f0;`,
                    mythBox: `background: #fff5f5; padding: 12px; border-radius: 6px; font-size: 14px; border-left: 4px solid #e53e3e; margin-top: 10px; color: #742a2a;`,
                    textBlock: `background: #fffaf0; padding: 15px; border-radius: 6px; border: 1px dashed ${c.accent}; color: #2d3748; font-family: 'Lora', serif; white-space: pre-line; line-height: 1.6;`,
                    grid: `display: grid; grid-template-columns: 1fr; gap: 10px;`
                };
                
                // Helper: safe get with default
                const get = (p, d) => {
                    if (d === undefined) d = ""; 
                    return p.split('.').reduce((a, b) => a && a[b], data) || d;
                };
                const fmt = (t) => t ? t.trim() : "";

                // Logic for "Other Common Meanings"
                const otherMeanings = get('yield.other_common_meanings', []);
                let otherMeaningsHtml = '';
                if (Array.isArray(otherMeanings) && otherMeanings.length > 0) {
                     otherMeaningsHtml = `
                    <div style="margin-top: 15px; padding-top: 12px; border-top: 1px dashed ${c.border};">
                        <div style="font-size: 13px; font-weight: 700; color: ${c.sectionHeader}; margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.5px;">Other Common Meanings:</div>
                        <ul style="list-style-type: disc; padding-left: 18px; margin: 0; color: ${c.textSub}; font-size: 14px; line-height: 1.5;">
                            ${otherMeanings.map(m => `<li style="margin-bottom: 4px; padding-left: 4px;">${m}</li>`).join('')}
                        </ul>
                    </div>`;
                }

                // 1. Yield Section
                const yieldSec = `
                <div style="${s.section} background: white;">
                    <div style="display:flex; justify-content:space-between; align-items:flex-start;">
                        <div>
                            <div style="${s.sub}">${get('yield.syllabification')} • ${get('yield.part_of_speech')}</div>
                            <h1 style="${s.h1}">${get('yield.lemma')}</h1>
                            <div style="font-size: 14px; color: #a0aec0; margin-top: 4px;">User context: "${get('yield.user_word')}"</div>
                        </div>
                    </div>
                    <div style="margin-top: 15px;">
                        <div style="font-size: 18px; font-weight: 600; margin-bottom: 4px;">${get('yield.contextual_meaning.en')}</div>
                        <div style="font-size: 16px; color: #4a5568;">${get('yield.contextual_meaning.zh')}</div>
                    </div>
                    ${otherMeaningsHtml}
                </div>`;
                
                const etymData = data.etymology || {};
                const roots = etymData.root_and_affixes || {};
                const etymSec = `<div style="${s.section}"><h2 style="${s.h2}">Etymology: Deep Analysis</h2><div style="display:flex; gap: 5px; margin-bottom: 15px; font-family: monospace; font-size: 13px;">${roots.prefix && roots.prefix!=='N/A'?`<span style="${s.tag}">PRE: ${roots.prefix}</span>`:''}<span style="${s.tag} background: #ebf8ff; color: #2b6cb0;">ROOT: ${roots.root}</span>${roots.suffix && roots.suffix!=='N/A'?`<span style="${s.tag}">SUF: ${roots.suffix}</span>`:''}</div><p style="${s.p} font-size: 14px;"><strong>Structure:</strong> ${roots.structure_analysis||''}</p><p style="${s.p} font-size: 14px;"><strong>Source:</strong> ${etymData.historical_origins?.source_word||''} <span style="color:${c.accent}">(${etymData.historical_origins?.pie_root||''})</span></p>${etymData.historical_origins?.history_myth && etymData.historical_origins.history_myth !== 'N/A' ? `<div style="${s.mythBox}"><strong>History:</strong> ${etymData.historical_origins.history_myth}</div>`:''}<div style="margin-top: 15px;"><div style="${s.h3}">Visual Imagery</div><div style="${s.textBlock}">${fmt(etymData.visual_imagery_zh)}</div></div><div style="margin-top: 15px;"><div style="${s.h3}">Meaning Evolution</div><div style="${s.textBlock}">${fmt(etymData.meaning_evolution_zh)}</div></div></div>`;

                const cognates = get('cognate_family.cognates', []);
                const linkSec = `<div style="${s.section} background: #fffdfa;"><h2 style="${s.h2}">Link: Cognate Family</h2><p style="font-size:13px; color: ${c.textSub}; margin-bottom: 10px;">${get('cognate_family.instruction')}</p><div style="${s.grid}">${cognates.map(cog => `<div style="background: white; border: 1px solid ${c.border}; padding: 10px; border-radius: 6px;"><span style="font-weight: 700; color: ${c.sectionHeader}; font-size: 15px;">${cog.word}</span><div style="font-size: 13px; color: #4a5568; margin-top: 4px; border-top: 1px solid #f7fafc; padding-top: 4px;">${cog.logic}</div></div>`).join('')}</div></div>`;

                const examples = get('application.selected_examples', []);
                const appSec = `<div style="${s.section}"><h2 style="${s.h2}">Application: Practice</h2><div style="display: flex; flex-direction: column; gap: 12px;">${examples.map(ex => `<div style="border-left: 3px solid #cbd5e0; padding-left: 12px;"><div style="font-size: 11px; font-weight: bold; color: ${c.accent}; text-transform: uppercase; margin-bottom: 2px;">${ex.type}</div><div style="font-family: 'Lora', serif; font-size: 15px; color: #1a202c; margin-bottom: 2px;">${ex.sentence}</div><div style="font-size: 13px; color: #718096;">${ex.translation_zh}</div></div>`).join('')}</div></div>`;

                const synonyms = get('nuance.synonyms', []);
                const nuanceSec = `<div style="${s.section} border-bottom: none;"><h2 style="${s.h2}">Nuance: Synonyms</h2><ul style="list-style: none; padding: 0; margin: 0 0 15px 0;">${synonyms.map(syn => `<li style="margin-bottom: 6px; font-size: 14px;"><span style="font-weight: 700; color: ${c.textMain};">${syn.word}</span>: <span style="color: #4a5568;">${syn.meaning_zh}</span></li>`).join('')}</ul><div style="background: #edf2f7; padding: 12px; border-radius: 6px; font-size: 14px; border-left: 4px solid ${c.sectionHeader}; margin-top: 10px;"><strong style="display:block; margin-bottom: 6px; font-size: 13px; color: ${c.sectionHeader};">Image Differentiation:</strong><div style="white-space: pre-line; line-height: 1.6;">${fmt(get('nuance.image_differentiation_zh'))}</div></div></div>`;

                return `<div style="${s.card}">${yieldSec}${etymSec}${linkSec}${appSec}${nuanceSec}</div>`;
            },

            generateMarkdown(data) {
                // Helper: safe get with default
                const get = (p, d) => {
                    if (d === undefined) d = ""; 
                    return p.split('.').reduce((a, b) => a && a[b], data) || d;
                };
                const clean = (t) => t ? t.trim() : "";
                let md = "";

                md += `### Yield: 单词解析 (Context & Meaning)\n\n`;
                md += `* **用户单词**：${clean(get('yield.user_word'))}\n`;
                md += `* **音节划分**：${clean(get('yield.syllabification'))}\n`;
                md += `* **用户语境**："${clean(get('yield.user_context_sentence'))}"\n`;
                md += `* **词性**：${clean(get('yield.part_of_speech'))}\n`;
                md += `* **语境语义 (Contextual Meaning)**：\n`;
                md += `    * EN: ${clean(get('yield.contextual_meaning.en'))}\n`;
                md += `    * ZH: ${clean(get('yield.contextual_meaning.zh'))}\n`;
                
                const otherMeanings = get('yield.other_common_meanings', []);
                if (Array.isArray(otherMeanings) && otherMeanings.length > 0) {
                    md += `* **其他常见意思 (基于 Lemma "${clean(get('yield.lemma'))}")**：\n`;
                    otherMeanings.forEach((m, i) => md += `    ${i+1}. ${clean(m)}\n`);
                }
                md += `\n---\n\n`;

                md += `### Etymology: 深度分析 (Deep Analysis)\n\n`;
                const roots = get('etymology.root_and_affixes', {});
                md += `* **Root & Affixes**【English Only】:\n`;
                md += `    * Prefix: ${clean(roots.prefix) || 'N/A'}\n`;
                md += `    * Root: **${clean(roots.root)}**\n`;
                md += `    * Suffix: ${clean(roots.suffix) || 'N/A'}\n`;
                md += `    * Structure Analysis: ${clean(roots.structure_analysis)}\n\n`;
                
                const history = get('etymology.historical_origins', {});
                md += `* **Historical Origins**【English Only / Verified via Search】:\n`;
                md += `    * History/Myth: ${clean(history.history_myth) || 'N/A'}\n`;
                md += `    * Source Word: ${clean(history.source_word)}\n`;
                md += `    * PIE Root: ${clean(history.pie_root)}\n\n`;

                const imageryRaw = clean(get('etymology.visual_imagery_zh'));
                md += `* **词源画面**【中文撰写】:\n`;
                if(imageryRaw) imageryRaw.split('\n').forEach(line => { if(line.trim()) md += `    ${line.trim()}\n`; });
                md += `\n`;

                const evolutionRaw = clean(get('etymology.meaning_evolution_zh'));
                md += `* **词义演变**【中文撰写】：\n`;
                if(evolutionRaw) evolutionRaw.split('\n').forEach(line => { if(line.trim()) md += `    * ${line.trim()}\n`; });
                md += `\n---\n\n`;

                md += `### Link: 构词法家族 (Cognate Family)\n\n`;
                md += `* **核心逻辑**：${clean(get('cognate_family.instruction'))}\n\n`;
                const cognates = get('cognate_family.cognates', []);
                cognates.forEach((cog, i) => { md += `${i+1}. **${clean(cog.word)}**: ${clean(cog.logic)}\n`; });
                md += `\n---\n\n`;

                md += `### Application: 应用 (Practice)\n\n`;
                const examples = get('application.selected_examples', []);
                if (examples.length > 0) {
                    md += `* **精选例句 (Selected Examples)**：\n`;
                    examples.forEach((ex, i) => {
                        md += `    ${i+1}. (${ex.type})：${clean(ex.sentence)}\n`;
                        md += `        * (${clean(ex.translation_zh)})\n`;
                    });
                }
                md += `\n---\n\n`;

                md += `### Nuance: 近义词辨析 (Synonym Nuances)\n\n`;
                const synonyms = get('nuance.synonyms', []);
                if (synonyms.length > 0) {
                    md += `* **近义词 (Synonyms)**：\n`;
                    synonyms.forEach(syn => { md += `    * **${clean(syn.word)}**: ${clean(syn.meaning_zh)}\n`; });
                }
                md += `\n`;
                const diff = clean(get('nuance.image_differentiation_zh'));
                md += `* **画面辨析 (Image-based Differentiation)**:\n`;
                if(diff) diff.split('\n').forEach(line => { if(line.trim()) md += `    * ${line.trim()}\n`; });

                return md;
            },

            // Utils
            escapeHtml(unsafe) {
                return unsafe
                    .replace(/&/g, "&amp;")
                    .replace(/</g, "&lt;")
                    .replace(/>/g, "&gt;")
                    .replace(/"/g, "&quot;")
                    .replace(/'/g, "&#039;");
            },

            getExampleYaml() {
                return `yield:
  user_word: "bolstered"
  lemma: "bolster"
  syllabification: "bol-ster"
  user_context_sentence: "Neighborhoods with a large elderly population could be bolstered with cooling centers."
  part_of_speech: "Verb (Past Participle / Passive Voice)"
  contextual_meaning:
    en: "To support, strengthen, or prop up; specifically, to reinforce something weak or needing help by adding resources."
    zh: "支持，加强，改善；特指通过增加资源或外力来支撑某种脆弱的状况（如同垫上厚垫子一样）。"
  other_common_meanings:
    - "Noun: A long, thick pillow placed under other pillows for support."
    - "Verb: To boost or improve something intangible (e.g., confidence, morale)."

etymology:
  root_and_affixes:
    prefix: "N/A"
    root: "PIE *bhel- (to blow, swell)"
    suffix: "-ster (Old English suffix indicating an instrument or thing used for an action)"
    structure_analysis: "The word combines the concept of 'swelling' (*bhel-) with an instrumental suffix. A 'bolster' is literally 'a thing that is swollen/stuffed'."
  historical_origins:
    history_myth: "N/A"
    source_word: "Old English 'bolster' (cushion, pillow); Proto-Germanic *bolkhstraz"
    pie_root: "*bhel- (to blow, to swell)"
  
  visual_imagery_zh: |
    1. 场景: 想象你面前有一个倾斜、摇摇欲坠的物体（比如一个松动的书架或疲惫的人）。
    2. 动作: 你拿来一个填充得非常饱满、圆鼓鼓的长枕头（Bolster），用力塞在这个物体的下方或背面。
    3. 体感: 随着枕头被挤压，你感觉到一种柔软但坚实的“回弹力”。原本松动的物体被这个“肿胀”的垫子稳稳地托住了，不再晃动。

  meaning_evolution_zh: |
    从“具体的画面”到“抽象含义”的演变：
    最初，"Bolster" 仅仅指那个“填充得鼓鼓囊囊的长枕头”（名词）。
    因为这种枕头常被用来垫在床头抬高头部，或者塞在家具下作为支撑，人们开始用它作动词。
    逻辑链条：用枕头垫高/支撑 -> 给予物理上的支撑 -> 引申为“给予某种脆弱事物额外的支持或加强”（如增强信心、加强防御、改善设施）。

cognate_family:
  instruction: "所有同源词都源自 PIE *bhel- (膨胀/吹气/肿胀)。"
  cognates:
    - word: "Ball"
      logic: "直接继承 *bhel- (膨胀) -> 想象物体‘膨胀’成圆球状 -> 球。"
    - word: "Balloon"
      logic: "词根 *bhel- (吹气/膨胀) -> 被吹大、鼓起来的物体 -> 气球。"
    - word: "Bowl"
      logic: "词根 *bhel- (膨胀) -> 想象一个物体向外‘鼓出’形成的空间 -> 碗/盆。"
    - word: "Bulk"
      logic: "词根 *bhel- (膨胀) -> 想象货物堆积、膨胀的样子 -> 体积/大块。"

application:
  selected_examples:
    - type: "Literal / Root Image"
      sentence: "She propped herself up on the bolster to read in bed."
      translation_zh: "她靠在那个长枕头上，在床上读书。（最原始的含义）"
    - type: "Current Context"
      sentence: "The city's defenses were bolstered by the arrival of fresh troops."
      translation_zh: "随着生力军的到来，城市的防御得到了加强。（如同给防线垫上了厚实的支撑）"
    - type: "Abstract / Metaphorical"
      sentence: "Good feedback bolstered his confidence."
      translation_zh: "积极的反馈增强了他的信心。（信心像泄气的球被‘充气’撑起来了）"

nuance:
  synonyms:
    - word: "Support"
      meaning_zh: "支持（最通用的词）"
    - word: "Reinforce"
      meaning_zh: "加固（侧重于增加材料使结构更强，如钢筋混凝土）"
    - word: "Strengthen"
      meaning_zh: "加强（侧重于力量的提升）"
  
  image_differentiation_zh: |
    对比 "Support" 和 "Bolster"：
    "Support" 只是单纯的“托举”，比如柱子支撑屋顶（静态）。
    "Bolster" 带有更强的“补救”或“垫衬”意味。它暗示原有的结构可能不够强或不够舒适，所以需要从外部塞入一个“缓冲物”或“加厚层”来支撑它。
    
    在你的句子中，"bolstered with cooling centers" 意味着社区本身抗热能力弱（像松动的物体），而“冷却中心”就像塞进去的“厚枕头”，为脆弱的人群提供了额外的缓冲和支持。`;
            }
        };

        // Boot
        App.init();

    </script>
</body>
</html>